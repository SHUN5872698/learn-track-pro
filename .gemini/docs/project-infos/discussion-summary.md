# これまでの議論の要点まとめ（最新版：2025年11月10日更新）

## 背景・経緯

### プロジェクトの概要

- **プロジェクト名**: LearnTrack Pro - プログラミング学習管理プラットフォーム
- **技術スタック**: Laravel 12 / Vue 3 (Composition API) / Pinia / MySQL 8.0
- **構成**: モノリシックSPA
- **現在の状態**: Phase 3完了 → SSL化完了、HTTPS本番稼働中、プロフィール画像機能準備完了

### 目的・目標

- 転職活動用ポートフォリオとして公開
- 実用的なDevOps経験の習得（Docker本番運用、Git戦略、自動化）
- コスト最適化を最優先

### 主要な制約

- TypeScript不使用、Bootstrap/jQuery/Options API禁止
- 個人開発のため実装工数を最小限に
- デプロイ優先、完璧主義を避ける
- **予算制約**: 月1,000-3,000円（転職活動期間3-6ヶ月）
- **Git管理対象**: `laravel-docker/src/`のみ（インフラ設定は対象外）

---

## 完了・確定事項

### プロジェクトの現在地

- ✅ Phase 0-2: アプリケーション開発完了（10/14-22）
- ✅ Phase 3-1: デプロイ先選定完了（10/23）
- ✅ Phase 3-2: VPS環境構築完了（10/25-30）
- ✅ Phase 3-3: Git戦略実装完了（10/30）
- ✅ Phase 3-4: Laravel初期化とデプロイ準備完了（11/3-4）
- ✅ Phase 3-5: SSL化とドメイン設定完了（11/5-6）
- ✅ Phase 3-6: 包括的ドキュメント作成完了（11/7）
- ✅ Phase 3-7: プロフィール画像機能の基盤準備完了（11/10）

### 直近完了した実装（11/10）

1. ✅ ローカル・VPS環境の権限設定統一
2. ✅ プロフィール画像用ディレクトリ作成と権限設定
3. ✅ 環境構築メモ⑤の更新
4. ✅ 手動画像設置手順の追加（検証用）
5. ✅ 当初の目的達成確認

### 作成済みドキュメント

- 環境構築メモ①〜⑧（Ubuntu設定、MySQL、バックアップ、Docker、アプリ環境、Git戦略、Laravel初期化、SSL/ドメイン）
- 本番環境構築手順書（包括的ドキュメント）
- 手動デプロイフロー
- TasksDB vs 開発ドキュメント管理DB：使い分けガイド

---

## これまでの議論で確定した方針

### 1. 包括的ドキュメントの管理方針

**要点**: 3つ以上の詳細ドキュメントがある場合、包括的ドキュメントを作成してDB表示件数を削減

**判断基準**: 視認性向上、全体像把握、認知負荷軽減

**プロパティ設定**: 包括的ドキュメント（詳細ページ = false）、詳細ドキュメント（詳細ページ = true）

### 2. 詳細ドキュメントを子ページ化しない理由

**要点**: すべてDB管理下に独立して配置し、包括ドキュメントからメンションリンクで接続

**判断基準**: 親ページ削除時の誤削除リスク回避、カテゴリやタグでの検索・絞り込みを可能にする

### 3. Notion単独管理 vs Git共同管理の基準

**TasksDB**: Notion単独管理（タスク管理の性質上Git管理不要）

**包括的ドキュメント**: Notion単独管理（目次・ナビゲーション、頻繁に更新しない）

**詳細ドキュメント**: Git共同管理（実装と密接に関連、バージョン管理必要）

### 4. 包括的ドキュメントの基本構成

**必須セクション**: 概要、詳細ページ一覧、トラブルシューティング、参考資料

**任意セクション**: 構築環境/システム構成、完了チェックリスト、実際の構築時間

**判断基準**: 状況に応じて必要なセクションのみ追加し、構成をシンプルに保つ

### 5. 実際の構築時間の記載ルール

**記載条件**: 実際に作業時間を記録している場合のみ

**記載内容**: リアルな作業時間（理想的な所要時間ではなく実測値）、トラブルシュートも含める、赤字注釈で問題点も正直に記載

**理由**: ポートフォリオとして説得力、スキルレベルに大きく左右されるため記録がない場合は記載しない

### 6. 手順書の文法・構成の一貫性

**見出し構造**: 見出し4（####）禁止、見出し3（###）まで使用、以下は太字

**コールアウトの制約**: コードブロック/コマンド不可、インラインコードと簡潔な箇条書きのみ

**論理展開**: 概要→詳細の順で記載、段階的に読める構成

**視覚化**: Mermaid図と表をバランスよく配置、表の連続を避ける

### 7. VPS環境でのファイル権限設定

**要点**: `storage/`と`bootstrap/cache/`は`www-data:www-data`所有、パーミッション775

**判断基準**: Webサーバープロセス（www-data）がファイル作成・書き込みを行うため、適切な所有権が必須

**トラブル回避**: git clone直後に必ず設定することで時限爆弾的なPermission deniedエラーを防止

### 8. プロフィール画像用ディレクトリの権限管理

**要点**: `storage/app/public/images/avatars`は`www-data:www-data`所有、パーミッション775で事前作成

**判断基準**: ファイルアップロード機能実装時に自動的に適切な権限でファイル保存されるため、ディレクトリのみ事前設定が必要

**ローカル環境との統一**: ローカルとVPSで同じ権限設定を適用し、環境差異を最小化

### 9. Apache VirtualHost完全設定戦略

**4つのVirtualHost構成**:

- HTTP:80 - IPアドレス用（ドメインへリダイレクト）
- HTTP:80 - ドメイン用（HTTPSへリダイレクト）
- HTTPS:443 - IPアドレス用（ドメインへリダイレクト）
- HTTPS:443 - ドメイン用（メインアプリ実行）

**判断基準**: SEO重複コンテンツ防止、ユーザー体験向上、セキュリティ最適化

### 10. Git戦略とブランチ管理

**ブランチ構成**: main（本番専用）、develop（開発・統合）、feature（個別機能開発）

**.gitattributes による環境別ファイル保護**: config/cors.php merge=ours、.gitignore merge=ours

**運用ルール**: ローカル設定変更はdevelopでコミット、本番設定変更はmainで直接コミット

詳細: 環境構築メモ⑥参照

### 11. Docker本番環境の構成

**リソース制限（メモリ2GB環境）**: PHPコンテナ最大1GB、MySQL（ホスト）512-768MB、システム予約256MB

**platform設定**: linux/amd64（Xserver VPS = x86_64）

**MySQL接続**: extra_hosts: host.docker.internal:host-gateway

**判断基準**: OOM Killer発動を防ぎシステム全体の安定性維持

詳細: 環境構築メモ⑤参照

### 12. MySQL自動バックアップ

**バックアップ**: cronで毎日午前4時、7日間保持

**復旧最適化**: mysqldumpに`DROP TABLE IF EXISTS`含まれる → DB初期化不要

詳細: 環境構築メモ③参照

### 13. デプロイ先選定

**結論**: Xserver VPS 2GB（月1,150円）

**AWS断念理由**: EC2+RDS月4,947円（予算の3-5倍）

### 14. ハイブリッド構成

**構成**: LaravelのみDocker化、MySQLは直接インストール

**理由**: LaravelはCI/CD自動化が目的、MySQLはメモリ2GBでの安定性優先

---

## やってはいけないこと

1. SSHパスワード認証を有効化
2. rootで直接ログイン許可
3. socket activation有効でポート変更
4. fail2banなしでSSH開放
5. MySQLのDocker化
6. バックアップ復旧時にDB削除・再作成
7. mainでローカル用設定をコミット
8. .gitattributesなしで環境別ファイル管理
9. docker-compose.ymlにimage指定とbuild指定を併記
10. BuildKitキャッシュを放置
11. git clone後にstorage/権限設定をしない
12. IPアドレスアクセスをリダイレクトせず放置
13. 詳細ドキュメントを子ページ化
14. 実際の構築時間を架空の「理想的な所要時間」で記載
15. プロフィール画像用ディレクトリの権限設定を省略

---

## 技術選択と教訓

### 重要な技術選択の判断

1. **Xserver VPS選択**: AWS断念（コスト5倍） → 予算内実現最優先
2. **ハイブリッド構成**: Laravel Docker化 + MySQL直接 → メモリ2GB環境での安定性
3. **包括的ドキュメント戦略**: 8つの詳細ドキュメントを1つにまとめ → DB視認性向上、認知負荷軽減

### 重要な教訓

1. **Permission deniedは時限爆弾**: ファイル権限問題は初回git clone時に予防的に設定すべき
2. **環境差異の最小化**: ローカルとVPSで権限設定を統一することで予期せぬエラーを防止
3. **段階的に読める構成の重要性**: 表の連続を避け、Mermaid図・コールアウトをバランスよく配置
4. **論理展開は概要→詳細**: 読者が段階的に理解できる構成が最優先
5. **視覚的理解の必要性**: 文章のみで羅列せず、Mermaid図や表で直感的に理解できる構成
6. **ドキュメント品質統一**: 見出し構造とコールアウトの制約で保守性向上
7. **リアルな記録の価値**: 実際の作業時間を正直に記録することがポートフォリオとして説得力を持つ
8. **機能実装前の基盤準備**: プロフィール画像機能のようなファイルアップロード系は、ディレクトリと権限を事前準備することでスムーズな実装が可能

---

## 次のアクション

### Phase 4-1: プロフィール画像アップロード機能実装（優先度: 高）

**工数**: 1-2日

**作業内容**:

- フロントエンド：画像選択UI、プレビュー、アップロードAPIコール
- バックエンド：画像バリデーション、保存処理、古い画像削除
- 動作確認：ローカル・VPS両環境でテスト

### Phase 4-2: CI/CD構築（優先度: 中）

**工数**: 2-3日

**作業内容**:

- GitHub Actionsによる自動テスト
- 自動デプロイパイプライン構築
- デプロイ通知設定

### Phase 4-3: 監視・ログ設定（優先度: 低）

**工数**: 1-2日

**作業内容**:

- アクセスログ分析
- エラー通知設定
- パフォーマンス監視

---

## 特記事項

### プロジェクト健全性

- **進捗**: 優良（Phase 3完了、HTTPS本番稼働中、プロフィール画像機能準備完了）
- **技術的負債**: 最小限
- **ドキュメント**: 優良（全手順記録済み、包括的ドキュメントで視認性向上）
- **自動化**: 良好（バックアップ、キャッシュクリーンアップ）
- **セキュリティ**: 優良（SSL/TLS、SSH多層防御、fail2ban）

### 現在の状態

**本番環境**: 完全稼働中

**次の焦点**: プロフィール画像アップロード機能実装（優先度: 高）

**準備完了**: ディレクトリ・権限設定済み、実装開始可能

### デプロイまでのクリティカルパス

**完了**: SSL化・ドメイン設定完了により本番公開済み

**残作業**: 追加機能実装（任意）、CI/CD自動化（任意）、監視設定（任意）

---

**最終更新**: 2025年11月10日
