# これまでの議論の要点まとめ（最新版：2025年10月25日更新）

## 背景・経緯

### プロジェクトの概要

- **プロジェクト名**: LearnTrack Pro - プログラミング学習管理プラットフォーム
- **技術スタック**: Laravel 12 / Vue 3 (Composition API) / Pinia / MySQL 8.0
- **構成**: モノリシックSPA
- **現在の状態**: ✅ Phase 3-1完了（デプロイ先選定）（10/23） → 🎯 **Phase 3-2進行中（VPS環境構築）（10/25）** ← 今ここ

### 目的・目標

- 転職活動用ポートフォリオとして公開
- 実用的なDevOps経験の習得（Docker本番運用、CI/CD）
- コスト最適化を最優先

### 主要な制約

- TypeScript不使用、Bootstrap/jQuery/Options API禁止
- 個人開発のため実装工数を最小限に
- デプロイ優先、完璧主義を避ける
- **予算制約**: 月1,000-3,000円（転職活動期間3-6ヶ月）

---

## 完了・確定事項

### プロジェクトの現在地

- ✅ Phase 0-2: アプリケーション開発完了（10/14-22）
- ✅ Phase 3-1: デプロイ先選定完了（10/23）
- 🔄 **Phase 3-2: VPS環境構築進行中（10/25）**

### Phase 3-2完了内容（10/25）

- VPS環境構築ドキュメントの大幅改善
- SSH/セキュリティ設定手順の最適化
- socket activation、fail2banの技術的背景の理解と文書化

### 作成済みドキュメント

**Phase 3-1（デプロイ先選定）**:

- デプロイ先選定の詳細ドキュメント（AWS環境構築）
- AWS料金調査、コスト比較表
- VPS採用理由、ハイブリッド構成の詳細
- 無料トライアル活用戦略
- 転職面接での回答例

**Phase 3-2（VPS環境構築）**:

- `【XserVPS】環境構築メモ①【Ubuntuの設定】`（改善版）
- SSH接続設定、ユーザー作成、sshd設定、セキュリティ対策の体系的手順書

---

## これまでの議論で確定した方針

### 1. デプロイ先選定の判断基準（★最重要）

**結論**: Xserver VPS 2GB（月1,150円）を採用

**AWS断念の理由**:

- EC2 + RDS: 月4,947円（予算の約3-5倍）
- EC2のみ: 月2,132円（依然VPSの1.85倍）
- RDSが異常に高い（月約3,100円、VPS全体より高い）
- RDSの機能（自動バックアップ等）はVPSでcron実装可能
- 小規模アプリではAWSの利点（スケーリング）を活かせない

**判断基準**: コスト最適化 > クラウドブランド

詳細: AWS環境構築ドキュメント参照

### 2. ハイブリッド構成の採用（★最重要）

**構成**: LaravelのみDocker化、MySQLは直接インストール

**理由**:

- **LaravelのみDocker化**: CI/CDでイメージビルド自動化が目的
- **MySQLは直接インストール**:
    - メモリ2GBでギリギリ
    - コンテナ数が増えると内部/外部ネットワーク設定が複雑化
    - コンテナごとのユーザー作成、セキュリティ設定の手間
    - 過去の経験で複雑化して断念した経緯
- **AWS RDS構想と同じ発想**: 外部DBサービスとして扱う
- **phpMyAdmin使用**: GUI操作の個人的好み

詳細: AWS環境構築ドキュメント参照

### 3. VPS環境構築の方針（★新規・重要）

**SSH鍵設定の簡略化**:

- 従来の複雑なsshコマンド → シンプルな`cp`コマンドに変更
- 理由: 既にVPS上で作業しているため、ローカルからの再接続は不要

**SSH認証の多層防御**:

```
PasswordAuthentication no         → パスワード認証を無効化
PermitEmptyPasswords no           → 空パスワードを禁止
KbdInteractiveAuthentication no   → 対話型認証を無効化
```

この3つがセットで鍵認証のみを強制

**socket activationの理解**:

- Ubuntu 24.04では22番ポート固定
- sshd_configで19000番に変更しても、ssh.socketが優先される
- VPS用途では無効化が正解
- 判断基準: 「閉じている」ではなく「監視されていない」が正確

**fail2banの役割**:

- パケットフィルター（静的防御）だけでは不十分
- fail2ban（動的防御）でブルートフォース攻撃を検知・ブロック
- 多層防御（Defense in Depth）の考え方

詳細: `【XserVPS】環境構築メモ①【Ubuntuの設定】` 参照

### 4. 学習価値の再定義（★重要）

**方針転換**: クラウド経験 → 開発力重視

**アピールポイント**:

- コスト最適化の意思決定
- Docker本番運用、CI/CD構築
- クラウド移行も考慮した設計（コンテナ化済み）

**転職面接での回答方針**: 「コスト最適化でVPS選択。Dockerコンテナ化によりクラウド移行も容易」

### 5. 従来の確定方針（Phase 0-2）

**Axiosインスタンスの使い分け**:

- `/api/*` → `import api from '@/plugins/axios'`
- `/fortify/*`, `/sanctum/*` → `import axios from 'axios'`

**エラーハンドリングの3原則**:

1. 再スロー必須
2. ストアは使用直前に初期化
3. GlobalErrorModalはApp.vue直下

**レスポンシブ対応の2サイズ戦略**:

- モバイル（〜767px）とデスクトップ（768px〜）のみ
- `md:`使用、`sm:`は使用しない

**@apply化による共通スタイル統一**:

- `.section-header`, `.form-input-base`等
- コード重複40%削減

**コンソールログの扱い**:

- Viteのビルド時自動削除（`terserOptions`）
- Phase 3デプロイ直前に確認

---

## やってはいけないこと（★重要）

**Phase 0-2（アプリケーション開発）**:

1. **Axiosインスタンスの混同** - `/api/*`で`axios`を使う
2. **ストアでエラーを握りつぶす** - `throw error;`必須
3. **TailwindCSSの`sm:`使用** - `md:`のみ使用
4. **完璧主義** - リスクベースで優先度判断

**Phase 3-2（VPS環境構築）**:

1. **SSHのパスワード認証を有効にする** - セキュリティリスク大
2. **rootユーザーで直接ログインを許可** - 攻撃対象を増やす
3. **socket activationを有効なままポート変更** - 19000番に接続できない
4. **fail2banなしでSSHポートを開放** - ブルートフォース攻撃に無防備
5. **MySQL のDocker化** - ハイブリッド構成を採用

---

## 技術選択と教訓

### 重要な教訓

1. **コスト最適化が最優先**: クラウドブランドよりも予算内で実現可能な構成
2. **過去の経験を活かす**: Docker全体化の複雑さを経験済み → ハイブリッド構成
3. **VPSで実装可能なAWS機能は多い**: cron、ufw、fail2ban等で代替可能
4. **完璧主義を避ける**: デプロイ優先、理想より実用性
5. **技術的背景の理解が重要**: 「なぜ」を理解することで応用が効く（socket activation、fail2ban等）
6. **多層防御の考え方**: 一つの対策だけでは不十分
7. **ドキュメントの視覚化**: Mermaid図、表、calloutで理解度が劇的に向上

---

## 次のアクション

### Phase 3-2: VPS環境構築（優先度: ★★★★★）

**工数見積**: 残り3-5日

**残作業**:

1. ✅ 環境構築手順書の作成（完了）
2. 無料トライアル申し込み（2GBプラン）
3. VPS初期設定実行（ドキュメントに従って）
4. Docker本番用ファイル作成（[`docker-compose.prod](http://docker-compose.prod).yml`, [`Dockerfile.prod`](http://Dockerfile.prod)）
5. Laravel デプロイ、動作確認

**ブランチ例**:

- `chore/vps-setup`
- `chore/docker-production-config`
- `chore/security-hardening`

### Phase 3-3: CI/CD構築（優先度: ★★★★☆）

**工数見積**: 2-3日

**内容**:

- GitHub Actions設定
- 自動デプロイパイプライン構築
- 本番ビルド確認（console.log削除確認）

---

## 特記事項

### プロジェクトの健全性評価

- **進捗状況**: ✅ 優良（Phase 3-2進行中）
- **技術的負債**: ✅ 最小限
- **ドキュメント**: ✅ 優良（デプロイ先選定、VPS環境構築の詳細記録済み）

### デプロイまでのクリティカルパス

**約5-8日**:

- Phase 3-2（VPS環境構築・残作業）: 3-5日
- Phase 3-3（CI/CD）: 2-3日

### セキュリティ理解度評価

**現在の立ち位置**: 中級〜上級の入り口（Web開発者としては十分）

**達成レベル**:

- ✅ SSH基本セキュリティ: 上級レベル
- ✅ ネットワーク防御: 中級〜上級
- ✅ 仕組みの理解: 中級〜上級

**次の学習ステップ**: アプリケーションセキュリティ（XSS、SQLインジェクション、CSRF）、SSL/TLS証明書管理
