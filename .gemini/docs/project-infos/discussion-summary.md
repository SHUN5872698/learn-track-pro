# これまでの議論の要点まとめ（最新版：2026年1月21日更新）

## 背景・経緯

### プロジェクトの概要

- **プロジェクト名**: LearnTrack Pro - プログラミング学習管理プラットフォーム
- **技術スタック**: Laravel 12 / Vue 3 (Composition API) / Pinia / MySQL 8.0
- **構成**: モノリシックSPA
- **現在の状態**: プロフィール画像アップロード機能のPhase 3（フロントエンド実装）完了、Phase 4（テスト・検証）準備段階

### 目的・目標

- 転職活動用ポートフォリオとして公開
- プロフィール画像アップロード機能を題材にCI/CDを段階的導入
- 「テスト→CI→デプロイ自動化」の順で実装

### 主要な制約

- TypeScript不使用、Bootstrap/jQuery/Options API禁止
- 個人開発のため実装工数を最小限に
- デプロイ優先、完璧主義を避ける
- **予算制約**: 月1,000-3,000円（転職活動期間3-6ヶ月）
- **Git管理対象**: `laravel-docker/src/`のみ（インフラ設定は対象外）
- **転職活動タイムライン**: 2026年1月〜3月が書類選考・面接期間

---

## 完了・確定事項

### プロジェクトの現在地

- ✅ Phase 0-3: アプリケーション開発・VPS環境構築・SSL化完了
- ✅ Phase 1: 設計・準備（Apidog更新、要件定義書、簡易設計&画面フロー更新）
- ✅ Phase 2: バックエンド実装完了
- ✅ Phase 3: ユニットテスト完了（8ケース全て成功）
- ✅ Phase 4: フロントエンド実装完了
- 🔄 Phase 5: テスト・検証（次のアクション、一部残）

### 直近完了した実装（1/21）

1. ✅ `AvatarUploadModal.vue`（アバターアップロードモーダル）
2. ✅ `ProfileEdit.vue`（モーダル統合）
3. ✅ `profileValidator.js`（バリデーション関数追加）
4. ✅ `auth.js`（uploadAvatarアクション追加）
5. ✅ `BaseButton.vue`（icon-dark variant追加）

### 作成済みドキュメント

- 環境構築メモ①〜⑧、本番環境構築手順書
- API設計（包括的ドキュメント）、各API仕様書
- 開発仕様書作成用プロンプト（便利プロンプト集）
- プロフィール画像アップロード機能タスクページ
- プロフィール画像アップロードユニットテスト仕様書

---

## これまでの議論で確定した方針

### 1. Service層の導入方針

**要点**: 機能単位（`User/AvatarService`）でService層を導入。Repository層は不要。

**判断基準**: 個人開発の規模ではRepository層はオーバースペック、必要になったら追加

### 2. バリデーション構成

**要点**: Laravelの`mimes`ルールのみ使用（`mimetypes`は冗長）、マジックバイト検証はServiceで実施

**判断基準**: `mimes`は内部でMIMEタイプを検証するため`mimetypes`との併用は不要

### 3. テスト方針（画像テスト）

**要点**: WebPテストには実画像フィクスチャを使用。`UploadedFile::fake()->create()`はマジックバイト検証で失敗する。

**判断基準**: Laravelの`fake()->image()`はWebP非対応、`fake()->create()`は正しいマジックバイトを持たない

### 4. ユニットテストと統合テストの分離

**要点**: Phase 3（PHPUnit）とPhase 5（Apidog・手動）を分けて実施

**判断基準**: 仕様が確定的なら手戻りリスクは低く、バックエンド/フロントエンドで区切る方が進捗管理しやすい

### 5. ドキュメント運用ルール

**要点**:

- ユニットテスト仕様書にはユニットテストの内容のみ記載
- タスクページには詳細を書かず、専用ドキュメントへの参照リンクのみ

**判断基準**: 完了した作業の詳細をタスクページに書くと更新が雑になる

### 6. 関心の分離（レイヤードアーキテクチャ）

**要点**: Controller→Service→Modelの層構造を採用。DDDやマイクロサービスではない。

**判断基準**: Fat Controller防止と単一責任原則の適用が目的

### 7. 汎用コンポーネントの拡張方針（icon-dark）

**要点**: BaseButtonに暗い背景用variant（icon-dark）を追加。白文字・padding無し・フォーカスリング無効化。

**判断基準**: baseClassesのfocus:ring-offset-2が白背景前提の設計だったため、暗い背景で白枠問題が発生。既存variantに影響を与えず、新variantで対応。

---

## やってはいけないこと

1. SSHパスワード認証を有効化
2. rootで直接ログイン許可
3. MySQLのDocker化
4. mainでローカル用設定をコミット
5. SecretsにJSONやYAMLを保存
6. Dependabot PRをclose
7. `UploadedFile::fake()->create()`でマジックバイト検証が必要なテストを書く

---

## 技術選択と教訓

### 重要な技術選択の判断

1. **Service層のみ採用**: Repository層は個人開発では過剰、Modelへの直接アクセスで十分
2. **実画像フィクスチャ採用**: Laravelの`fake()->image()`はWebP非対応のため、実画像を`tests/Fixtures/`に配置

### 重要な教訓

1. Laravelの`UploadedFile::fake()->create()`はランダムバイト列を生成するため、マジックバイト検証では使用不可
2. Laravelの`UploadedFile::fake()->image()`はJPEG/PNG/GIFのみ対応、WebPは非対応
3. テスト種別ごとに専用ドキュメントを作成し、タスクページには参照リンクのみ記載する
4. 汎用コンポーネントは全ユースケースを事前に想定しきれない。問題発生時に既存影響を避けて拡張する方針が現実的

---

## 次のアクション

### Phase 4: テスト・検証（優先度: 最高）

**工数**: 0.5日

**作業内容**:

- アップロード成功後のアバター反映確認（残タスク）
- Apidogテスト実行
- 手動テスト実行

### Phase 5: ドキュメント更新（優先度: 高）

**工数**: 0.5日

**作業内容**: API設計、認証機能テストリスト、ディレクトリ構造等の更新

### Phase 6: CI/CD（優先度: 中）

**工数**: 1日

**作業内容**: GitHub Actionsワークフロー作成、PR作成・マージ

---

## 特記事項

### プロジェクトの健全性評価

- **進捗**: 良好（Phase 4フロントエンド実装完了、動作検証のみ残）
- **技術的負債**: 低（Service層導入により責務分離が明確、icon-dark追加で汎用コンポーネント拡張）
- **ドキュメント**: 良好（テスト種別ごとに専用ドキュメントを分離、Phase別構成で進捗管理効率化）

### 実装完了までのクリティカルパス

- テスト・検証: 0.5日
- ドキュメント更新: 0.5日
- CI/CD: 1日
- **合計: 約2日**
