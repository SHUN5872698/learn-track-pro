## 相互リンク

[**これまでの議論の要点まとめ**](https://www.notion.so/2809d86c12e880e485b9e08ef6eddb83?pvs=21) 

.gemini/docs/project-infos/discussion-summary.md

---

```markdown
# これまでの議論の要点まとめ（最新版：2025年10月11日更新）

## 背景・経緯

### プロジェクトの概要

- プロジェクト名: LearnTrack Pro - プログラミング学習管理プラットフォーム
- 開発期間: 2025年9月3日〜10月11日（6週間）
- 現在日: 2025年10月11日（土）
- 開発者: 藤井俊祐氏（転職活動用ポートフォリオ）
- 開発手法: APIファーストアプローチ with AI駆動開発（GeminiCLI + Claude）
- 現在の状態: ✅ MVP完成（2025年10月7日達成） → 改善フェーズ

### 目的・目標

- プログラミング学習に特化した進捗管理システム
- セクション単位での詳細な進捗可視化
- 技術分野別の学習時間分析機能

### 主要な制約条件

- TypeScript不使用（JavaScriptのみ）
- Bootstrapクラス・カスタムCSS禁止（TailwindCSSのみ）
- jQuery等レガシーライブラリ禁止
- Options API禁止（Composition APIのみ）
- 個人開発のため実装工数を最小限に

---

## 完了・確定事項

### プロジェクトの現在地

- ✅ MVP完成（2025年10月7日）
- ✅ 認証フロー・ログアウト処理修正完了
- ✅ バリデーション修正完了
- ✅ デスクトップレイアウト修正完了
- ✅ disable属性実装完了
- ✅ 手動テストドキュメント作成完了
- ✅ APIエラーハンドリング仕様確定（2025年10月11日）

### 作成済みのドキュメント・成果物

- .gemini/docs/tests/manual/authentication-manual-tests.md
- アーキテクチャドキュメント（Composables/Store責務分離）
- 各種バリデーション関数（authValidator.js, profileValidator.js, studySessionValidator.js）
- APIエラーハンドリング・例外処理の実装仕様書（2025年10月11日作成）

---

## 技術的検討事項

### 確定技術スタック

- Backend: Laravel 12.x (PHP 8.3+) / Laravel Sanctum / Fortify / MySQL 8.0
- Frontend: Vue.js 3 (Composition API) / Pinia / Vue Router / TailwindCSS 3.x / Headless UI / Vite

### アプリケーション構成の特性

- **モノリシックSPA構成**: Laravel（バックエンド）とVue（フロントエンド）は同一サーバー上
- Laravel障害時はVueも表示されない
- ネットワークエラー（クライアント側）の優先度は低い

---

## 現在の課題・検討点

### 改善タスク

#### 優先度：高（次に実施）

1. **APIエラーハンドリングの実装**（工数: 2日）
   - Axios Interceptorの実装
   - グローバルエラーモーダルの実装
   - エラーモーダルストアの実装

#### 優先度：中（後回し可）

2. 503エラーの確認と対策
3. レイアウトの細かい不備修正
4. APIドキュメントのバリデーション追加
5. 文字数カウンター実装（textarea）
6. 時間入力のループ機能

#### 優先度：低（余裕があれば）

7. 高速連続削除の完全対策（ローディングスピナー）
8. アニメーションの最適化

### 保留事項

- DELETE処理時の削除確認モーダルと500エラーモーダルの連携（実装フェーズで検討）

---

## これまでの議論で確定した方針

### 1. APIエラーハンドリングの基本方針

**対応するエラーの選定基準**:
- 実際に発生する可能性が高いエラーのみ対応
- 個人開発の工数を考慮し、現実的に必要なもののみ実装
- ユーザーに適切なフィードバックを提供できるもの

**表示方法の統一**:
- モーダルまたはコンポーネント表示で統一
- トースト通知は使用しない（視認性が低く、デザインに合わないため）

---

### 2. 対応するHTTPステータスコード

| ステータス | 対応方法 | 発生可能性 | 実装場所 |
|-----------|---------|-----------|---------|
| **401/419** | ログイン画面へリダイレクト | 高 | Axios Interceptor |
| **403** | エラーモーダル → ダッシュボードへ | 低〜中 | Axios Interceptor |
| **404** | エラーモーダル → ダッシュボードへ | 中〜高 | Axios Interceptor |
| **422** | フォーム内にエラー表示（実装済み） | 低 | 各コンポーネント |
| **429** | 実装しない | 極めて低 | - |
| **500** | エラーモーダル（再読み込み/ダッシュボード選択） | 中〜高 | Axios Interceptor |

#### 401/419の対応

- セッションタイムアウト、CSRF Token不一致時
- ログイン画面へ自動リダイレクト
- メッセージ表示不要（リダイレクトで状況が明確）

#### 403の対応

- 他ユーザーのリソースへのアクセス時
- モーダル表示: 「アクセスできません」
- モーダルを閉じたらダッシュボードへリダイレクト

#### 404の対応

- 削除済みデータへのアクセス時
- モーダル表示: 「データが見つかりません」
- モーダルを閉じたらダッシュボードへリダイレクト

#### 422の対応

- バリデーションエラー
- 既存実装を維持（各フォームコンポーネントでエラー表示）
- 新規実装不要

#### 429の対応

- レート制限超過
- 実装しない（個人利用アプリのため発生可能性が極めて低い）

#### 500の対応

- サーバーエラー、DBエラー、未処理例外
- モーダル表示: 「エラーが発生しました」
- ボタン: [ページを再読み込み] [ダッシュボードへ戻る]
- HTTPステータスコードは直接表示しない（ユーザーフレンドリーなメッセージに変換）

---

### 3. エラー表示パターン

**全体エラー表示の原則**:
- いずれか1つでもAPI取得に失敗した場合、ページ全体にエラー表示
- 部分的なデータは表示しない
- 理由: 学習記録管理アプリではデータの整合性が重要、部分的なデータ表示は誤解を招く

**対象外**:
- フォーム送信時のバリデーションエラー（422）は個別表示（既存実装）

---

### 4. 実装コンポーネント構成

#### Axios Interceptor（`resources/js/plugins/axios.js`）

役割:
- 全APIリクエストのレスポンスを監視
- ステータスコードに応じて適切な処理を実行
- 401/419 → ログイン画面へリダイレクト
- 403/404 → エラーモーダル表示（ダッシュボードへ）
- 500 → エラーモーダル表示（再読み込み/ダッシュボード選択）

#### グローバルエラーモーダル（`resources/js/components/common/GlobalErrorModal.vue`）

役割:
- エラー情報を受け取り、モーダルとして表示
- 動的な表示内容（タイトル、メッセージ、ボタン、アイコン）
- ユーザーアクション（ボタンクリック）を処理

#### エラーモーダルストア（`resources/js/stores/errorModal.js`）

役割:
- エラーモーダルの表示状態を管理
- エラー情報（タイトル、メッセージ、ボタン設定）を保持
- モーダルの表示/非表示を制御

状態:
- `isVisible`: モーダルの表示状態
- `title`: モーダルのタイトル
- `message`: エラーメッセージ
- `actions`: ボタンの設定
- `redirectTo`: 閉じた後のリダイレクト先（オプション）

---

### 5. Conventional Commits タイプの判断基準

判断フロー:

```
ステップ1: ユーザーは新しいことができるようになったか？
  YES → feat
  NO → 次へ

ステップ2: 既存機能が正しく動作していなかったか？
  YES → fix
  NO → feat
```

重要: AIツール（Gemini CLI等）の提案は参考程度。最終判断は人間が行う。

---

### 6. Composables と Store の責務分離

Store の責務:
- API通信
- 状態管理（state）
- シンプルなgetters

Composables の責務:
- 複数Storeの連携
- ビジネスロジック
- エラーハンドリング
- 統計計算・データ加工

判断基準チートシート:

| 条件 | 実装場所 |
|------|----------|
| API通信が必要 | Store |
| 単純なデータ取得・保存 | Store |
| 複数のStoreを使う | Composable |
| ビジネスルールがある | Composable |
| エラーハンドリングが複雑 | Composable |
| 統計計算・データ加工 | Composable |

---

### 7. フォームデータ管理の統一ルール

コンポーザブル化すべき条件（いずれか1つ該当）:
1. Create/Edit両方で使う
2. バリデーションロジックが複雑
3. モーダル管理などUI状態が複雑
4. フォーマット処理が必要

reactive（コンポーネント内）でOKな条件:
1. Editのみで使う（Createがない）
2. シンプルな入力フィールドのみ（3〜5個程度）
3. バリデーションが単純（必須チェック程度）

ref使用ケース:
- 単一の値のみ（例：`const isLoading = ref(false)`）

---

### 8. バリデーション実装の統一パターン

設計思想:
- Composableはフォームデータ管理のみに集中
- バリデーションは個別関数を直接呼び出し
- `{ isValid, message }` 形式の統一
- エラー表示の明確な分離（Vue側 vs API側）

---

### 9. 削除処理のdisable実装パターン

重要な順序（HeadlessUIのFocusTrapエラー回避）:
1. モーダルを閉じる
2. アニメーション完了待機（300ms）
3. `isSubmitting = true`
4. 削除処理実行
5. `isSubmitting = false`

高速連続削除の防止:
- `openDeleteModal`に`if (isSubmitting.value) return;`のガード条件追加
- MVP完成のため仮実装、将来的にローディング表示等で改善

---

### 10. ブランチ命名規則の判断基準

| 作業内容 | プレフィックス | 例 |
|---------|-------------|-----|
| 手動テストのドキュメント作成 | docs/ | docs/manual-test-cases |
| 自動テストコードの実装 | test/ | test/e2e-user-flow |
| APIドキュメント作成 | docs/ | docs/api-specification |
| README更新 | docs/ | docs/update-readme |

---

### やってはいけないこと

1. **HTTPステータスコードをユーザーに直接見せる**
   - 「403」「404」「500」という表示は避ける
   - ユーザーフレンドリーなメッセージに変換する

2. **トースト通知の使用**
   - 視認性が低い
   - アプリケーションのデザインに合わない
   - モーダルまたはコンポーネント表示で統一

3. **部分的なデータ表示**
   - 学習記録管理アプリではデータの整合性が最重要
   - いずれか1つでもAPI取得に失敗したら、ページ全体にエラー表示

4. **過度にコードサンプルを提示すること**
   - 現在の実装を見せていない段階での詳細なコード例は無価値
   - 説明は簡潔に、要点のみを伝える

5. **AIツールの提案を無批判に受け入れる**
   - AIは「提案」であり「決定」ではない
   - 最終判断は人間が行う

---

### 除外・後回し事項

**理由付き除外**:
- 文字数カウンター（textarea）: 優先度低
- 時間入力のループ機能: 優先度低
- 高速連続削除の完全対策（ローディング、トースト）: 仮実装で対応済み
- アニメーション最適化: 優先度低
- ネットワークエラー（クライアント側）: モノリシック構成のため発生可能性低
- 429エラー: 個人利用アプリのため発生可能性極めて低

**保留事項**:
- DELETE処理時の削除確認モーダルと500エラーモーダルの連携: 実装フェーズで詳細検討

---

## 次のアクション

### 最優先（工数: 2日）

1. **APIエラーハンドリングの実装**
   - Axios Interceptor実装（0.5日）
   - グローバルエラーモーダル実装（0.5日）
   - エラーモーダルストア実装（0.5日）
   - 統合テスト（0.5日）

### 次点

2. 503エラーの確認と対策
3. レイアウトの最終確認
4. APIドキュメントのバリデーション追加

### 余裕があれば

5. 文字数カウンター実装
6. 時間入力のループ機能
7. 高速連続削除の完全対策

---

## 特記事項

### プロジェクトの健全性

- コア機能完成度: 100%
- スケジュール: MVP完成、改善フェーズへ移行
- 技術的負債: 最小限（TODO管理済み）
- ドキュメント: 充実（仕様書作成済み）

総合評価: MVP完成、改善フェーズ開始

---

### 重要な教訓

1. **AIツールとの付き合い方**
   - AIは「提案」であり「決定」ではない
   - 最終判断は人間が行う
   - 過度なコードサンプルは現状を見せていない段階では無価値

2. **個人開発の現実的な優先順位付け**
   - すべてのエラーに対応する必要はない
   - 実際に発生する可能性が高いエラーのみ対応
   - 実装工数を最小限に抑える

3. **ユーザー体験の重視**
   - HTTPステータスコードは技術者向け、一般ユーザーには不親切
   - エラーメッセージはユーザーフレンドリーに
   - トースト通知より視認性の高いモーダル表示

4. **データ整合性の重要性**
   - 学習記録管理アプリでは部分的なデータ表示は誤解を招く
   - いずれか1つでもAPI取得に失敗したら全体エラー表示

5. **段階的な実装アプローチ**
   - 複雑な処理（DELETE時のモーダル連携）は保留
   - まずコア機能を実装し、後で詳細を詰める
```
