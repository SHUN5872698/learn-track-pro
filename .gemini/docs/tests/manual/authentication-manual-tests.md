## **1. ユーザー登録**

### **関連ファイル**

**コントローラー:**

- **app/Actions/Fortify/CreateNewUser.php**: `create` - 新規ユーザーをデータベースに登録するロジックを処理します。
- **app/Providers/FortifyServiceProvider.php**: `boot` - `CreateNewUser`アクションをLaravel Fortifyに登録しています。

**Piniaストア:**

- **resources/js/stores/auth.js**: `register` - ユーザー登録のAPI呼び出し、その後のログイン処理、エラーハンドリング、ローディング状態の管理を行います。

**コンポーネント:**

- **resources/js/views/auth/Register.vue**: ユーザー登録フォームのUIを提供し、入力値のバリデーションと登録処理のトリガーを行います。
- **resources/js/components/common/BaseButton.vue**: 登録フォームの「登録する」ボタンとして使用されます。

**バリデーション:**

- **resources/js/validators/authValidator.js**: `Register.vue`でクライアントサイドの入力値（名前、メールアドレス、パスワード）のバリデーションに使用されます。

### **1.1 正常なユーザー登録**

- [x]  `http://localhost:8000/register` にアクセスし、有効な名前、メールアドレス、パスワード、パスワード確認を入力して「登録する」ボタンをクリックしてください。
- [x]  登録後、ダッシュボード (`/dashboard`) にリダイレクトされ、ログイン状態であることを確認してください。

### **1.2 バリデーションエラー**

**名前**:

- [x]  名前を空欄にして登録し、「名前は必須項目です。」と表示されることを確認してください。
- [x]  名前を51文字以上にして登録し、「名前は50文字以内で入力してください」と表示されることを確認してください。

**メールアドレス**:

- [x]  メールアドレスを空欄にして登録し、「メールアドレスは必須項目です。」と表示されることを確認してください。
- [x]  無効なメールアドレス形式（例: `a@a`）で登録し、「メールアドレスは有効な形式で指定してください。」と表示されることを確認してください。
- [x]  既に登録済みのメールアドレスで登録し、「指定のメールアドレスは既に使用されています。」と表示されることを確認してください。

**パスワード**:

- [x]  パスワードを空欄にして登録し、「パスワードは必須項目です。」と表示されることを確認してください。
- [x]  パスワードを7文字以下にして登録し、「パスワードは8文字以上で入力してください。」と表示されることを確認してください。
- [x]  パスワードとパスワード確認が一致しない状態で登録し、「パスワードとパスワード確認が一致しません。」と表示されることを確認してください。

**パスワード表示/非表示切り替え**:

- [x]  パスワード入力フィールドの右側にあるアイコンをクリックして、パスワードの表示/非表示が切り替わることを確認してください。

**ローディング表示**:

- [x]  登録処理中に「登録する」ボタンがローディング状態（無効化）になることを確認してください。

**APIエラーハンドリング**:

- [x]  API通信でエラーが発生した場合（例: ネットワーク切断、バックエンドエラーなど）、適切なエラーメッセージが表示されることを確認してください。
  - (テスト方法例: **app/Actions/Fortify/CreateNewUser.php** の `return User::create()` メソッドの直前に `abort(500, 'Internal Server Error');` を一時的に追加)

---

## **2. ログイン**

### **関連ファイル**

**コントローラー:**

- **Laravel Fortify**: ログイン処理はLaravel Fortifyが内部で管理する`/fortify/login`エンドポイントによって処理されます。直接的なアプリケーションコントローラーは存在しません。
- **app/Http/Controllers/UserController.php**: `me` - ログイン成功後、認証済みユーザーの情報を取得するために利用されます。
- **app/Providers/FortifyServiceProvider.php**: `boot` - ログイン試行のレートリミッターなどのFortify関連設定が含まれます。

**Piniaストア:**

- **resources/js/stores/auth.js**: `login` - ログインAPIの呼び出し、ユーザー情報の取得（`fetchUser`）、エラーハンドリング、ローディング状態の管理を行います。

**コンポーネント:**

- **resources/js/views/auth/Login.vue**: ログインフォームのUIを提供し、入力値のバリデーションとログイン処理のトリガーを行います。
- **resources/js/components/common/BaseButton.vue**: ログインフォームの「ログイン」ボタンとして使用されます。

**バリデーション:**

- **resources/js/validators/authValidator.js**: `Login.vue`でクライアントサイドの入力値（メールアドレス、パスワード）のバリデーションに使用されます。

### **2.1 正常なログイン**

- [x]  `http://localhost:8000/login` にアクセスし、登録済みのメールアドレスとパスワードを入力して「ログイン」ボタンをクリックしてください。
- [x]  ログイン後、ダッシュボード (`/dashboard`) にリダイレクトされ、ログイン状態であることを確認してください。

### **2.2 バリデーションエラー**

**メールアドレス**:

- [x]  メールアドレスを空欄にしてログインし、「メールアドレスは必須項目です。」と表示されることを確認してください。
- [x]  無効なメールアドレス形式でログインし、「メールアドレスは有効な形式で指定してください。」と表示されることを確認してください。

**パスワード**:

- [x]  パスワードを空欄にしてログインし、「パスワードは必須項目です。」と表示されることを確認してください。

**認証失敗**:

- [x]  登録されていないメールアドレスまたは誤ったパスワードでログインし、「認証に失敗しました。」と表示されることを確認してください。

**パスワード表示/非表示切り替え**:

- [x]  パスワード入力フィールドの右側にあるアイコンをクリックして、パスワードの表示/非表示が切り替わることを確認してください。

**ローディング表示**:

- [x]  ログイン処理中に「ログイン」ボタンがローディング状態（無効化）になることを確認してください。

**APIエラーハンドリング**:

- [x]  API通信でエラーが発生した場合、適切なエラーメッセージが表示されることを確認してください。
  - Laravel Fortifyが内部的に認証処理を管理しているため、このようなAPIエラーは発生せず、テストできませんでした

---

## **3. ログアウト**

### **関連ファイル**

**コントローラー:**

- **Laravel Fortify**: ログアウト処理はLaravel Fortifyが内部で管理する`/fortify/logout`エンドポイントによって処理されます。直接的なアプリケーションコントローラーは存在しません。

**Piniaストア:**

- **resources/js/stores/auth.js**: `logout` - ログアウトAPIの呼び出し、クライアントサイドの認証状態クリア、Piniaストアのリセット、ログインページへのリダイレクトを行います。

**コンポーネント:**

- **resources/js/components/common/AppSidebar.vue**: サイドバーにログアウトボタンを提供し、クリック時にPiniaストアの`logout`アクションを呼び出します。
- **resources/js/layouts/DefaultLayout.vue**: `AppSidebar`コンポーネントを内包しており、ログアウト機能を含むアプリケーションのメインレイアウトを提供します。

### **3.1 正常なログアウト**

- [x]  ログイン後、ヘッダーまたはサイドバーの「ログアウト」ボタンをクリックしてください。
- [x]  ログアウト後、ログインページ (`/login`) にリダイレクトされ、ログアウト状態であることを確認してください（ダッシュボードにアクセスできないことを確認）。

### **3.2 ローディング表示**

- [x]  ログアウト処理中にローディング表示が適切に行われることを確認してください。
  - 即ログアウトされるのでローディングはでない仕様

### **3.3 APIエラーハンドリング**

- [x]  API通信でエラーが発生した場合でも、クライアント側でログアウト状態が正しく処理され、ログインページにリダイレクトされることを確認してください。
  - Laravel Fortifyが内部的に認証処理を管理しているため、このようなAPIエラーは発生せず、テストできませんでした

---

## **4. パスワードリセット要求**

### **関連ファイル**

**コントローラー:**

- **Laravel Fortify**: パスワードリセット要求（メール送信）はLaravel Fortifyが内部で管理する`/fortify/forgot-password`エンドポイントによって処理されます。直接的なアプリケーションコントローラーは存在しません。
- **app/Actions/Fortify/ResetUserPassword.php**: このファイルはパスワードリセット要求ではなく、実際にパスワードをリセットする際に使用されるアクションです。

**Piniaストア:**

- **resources/js/stores/auth.js**: `forgotPassword` - パスワードリセットメール送信のAPI呼び出し、エラーハンドリング、ローディング状態の管理を行います。

**コンポーネント:**

- **resources/js/views/auth/PasswordReset.vue**: パスワードリセット要求フォームのUIを提供し、入力値のバリデーションとリセット要求処理のトリガーを行います。
- **resources/js/components/common/BaseButton.vue**: フォームの「リセットリンクを送信」ボタンとして使用されます。

**バリデーション:**

- **resources/js/validators/authValidator.js**: `PasswordReset.vue`でクライアントサイドの入力値（メールアドレス）のバリデーションに使用されます。

### **4.1 正常なリセット要求**

- [x]  `http://localhost:8000/password-reset` にアクセスし、登録済みのメールアドレスを入力して「リセットリンクを送信」ボタンをクリックしてください。
- [x]  「パスワードリセット用のメールを送信しました。」という成功メッセージが表示されることを確認してください。
- [x]  数秒後、ログインページに自動的にリダイレクトされることを確認してください。
- [x]  指定したメールアドレスにパスワードリセットメールが届いていることを確認してください。

### **4.2 バリデーションエラー**

- [x]  メールアドレスを空欄にして送信し、「メールアドレスは必須項目です。」と表示されることを確認してください。
- [x]  無効なメールアドレス形式で送信し、「メールアドレスは有効な形式で指定してください。」と表示されることを確認してください。
- [x]  登録されていないメールアドレスで送信し、「このメールアドレスに一致するユーザーがいません。」と表示されることを確認してください。

### **4.3 ローディング表示**

- [x]  リセット要求処理中に「リセットリンクを送信」ボタンがローディング状態になることを確認してください。

### **4.4 APIエラーハンドリング**

- [x]  API通信でエラーが発生した場合、適切なエラーメッセージが表示されることを確認してください。
  - Laravel Fortifyが内部的に認証処理を管理しているため、このようなAPIエラーは発生せず、テストできませんでした

---

## **5. パスワードリセット実行**

### **関連ファイル**

**コントローラー:**

- **app/Actions/Fortify/ResetUserPassword.php**: `reset` - ユーザーが提供したトークンと新しいパスワードを使用して、パスワードを実際に更新するロジックが含まれます。
- **app/Providers/FortifyServiceProvider.php**: `boot` - `ResetUserPassword`アクションをLaravel Fortifyに登録しています。

**Piniaストア:**

- **resources/js/stores/auth.js**: `resetPassword` - パスワードリセット実行のAPI呼び出し（`/fortify/reset-password`）、エラーハンドリング、ローディング状態の管理を行います。

**コンポーネント:**

- **resources/js/views/auth/PasswordResetConfirm.vue**: パスワードリセット実行フォームのUIを提供し、入力値のバリデーションとパスワード更新処理のトリガーを行います。
- **resources/js/components/common/BaseButton.vue**: フォームの「パスワードをリセット」ボタンとして使用されます。

**バリデーション:**

- **resources/js/validators/authValidator.js**: `PasswordResetConfirm.vue`でクライアントサイドの入力値（メールアドレス、パスワード、パスワード確認）のバリデーションに使用されます。

### **5.1 正常なパスワード再設定**

- [x]  パスワードリセットメール内のリンクから `http://localhost:8000/reset-password/{token}?email={email}` の形式でページにアクセスしてください（`{token}`と`{email}`はメール内のものを使用）。
- [x]  新しいパスワードとパスワード確認を入力して「パスワードをリセット」ボタンをクリックしてください。
- [x]  「パスワードをリセットしました。ログインページに移動します。」という成功メッセージが表示されることを確認してください。
- [x]  数秒後、ログインページに自動的にリダイレクトされることを確認してください。
- [x]  新しいパスワードでログインできることを確認してください。

### **5.2 バリデーションエラー**

**メールアドレス**:

- [x]  メールアドレスを空欄にして送信し、「メールアドレスは必須項目です。」と表示されることを確認してください。
- [x]  無効なメールアドレス形式で送信し、「メールアドレスは有効な形式で指定してください。」と表示されることを確認してください。

**パスワード**:

- [x]  パスワードを空欄にして送信し、「パスワードは必須項目です。」と表示されることを確認してください。
- [x]  パスワードを7文字以下にして送信し、「パスワードは8文字以上で入力してください。」と表示されることを確認してください。
- [x]  パスワードとパスワード確認が一致しない状態で送信し、「パスワードとパスワード確認が一致しません。」と表示されることを確認してください。

**無効なトークン**:

- [x]  無効なトークン（例: URLのトークンを一部変更）でアクセスし、パスワードを再設定しようとすると「このパスワード再設定トークンは無効です。」と表示されることを確認してください。

**ローディング表示**:

- [x]  パスワードリセット処理中に「パスワードをリセット」ボタンがローディング状態になることを確認してください。

**APIエラーハンドリング**:

- [x]  API通信でエラーが発生した場合、適切なエラーメッセージが表示されることを確認してください。

---

## **6. プロフィール表示**

### **関連ファイル**

**コントローラー:**

- **app/Http/Controllers/UserController.php**: `me` - 認証済みユーザーのプロフィール情報を取得します。

**Piniaストア:**

- **resources/js/stores/auth.js**: `fetchUser` - 認証済みユーザーの情報をAPIから取得し、ストアに保存します。`authUser`ゲッターでユーザー情報を提供します。

**Composables:**

- **resources/js/composables/useUser.js**: `authStore`からユーザー情報を取得し、コンポーネントに提供します。

**コンポーネント:**

- **resources/js/views/user/Profile.vue**: ユーザーのプロフィール情報（名前、メールアドレス、アバター、登録日など）を表示します。
- **resources/js/components/common/UserAvatar.vue**: ユーザーのアバター画像またはイニシャルを表示します。
- **resources/js/layouts/DetailLayout.vue**: プロフィールページのレイアウトを提供します。

### **6.1 正常なプロフィール表示**

- [x]  ログイン後、サイドバーまたはヘッダーのユーザー名クリックでプロフィールページ (`/profile`) にアクセスしてください。
- [x]  自分の名前、メールアドレス、登録日、アバター画像（設定していれば）が正しく表示されることを確認してください。

### **6.2 未認証時のアクセス**

- [x]  ログアウト状態でプロフィールページに直接アクセスしようとすると、ログインページにリダイレクトされることを確認してください。

### **6.3 ローディング表示**

- [x]  プロフィール情報取得中にローディング表示が適切に行われることを確認してください。

---

## **7. プロフィール編集**

### **関連ファイル**

**コントローラー:**

- **app/Http/Controllers/UserController.php**: `profile` - ユーザーのプロフィール情報（名前、メールアドレス）を更新します。
- **app/Http/Requests/User/ProfileRequest.php**: プロフィール更新リクエストのサーバーサイドバリデーションルールを定義します。

**Piniaストア:**

- **resources/js/stores/auth.js**: `updateProfile` - プロフィール更新APIの呼び出し、ストアのユーザー情報更新、エラーハンドリング、ローディング状態の管理を行います。

**Composables:**

- **resources/js/composables/useUser.js**: `updateUserProfile` - プロフィール更新処理を`authStore`に委譲します。

**コンポーネント:**

- **resources/js/views/user/ProfileEdit.vue**: プロフィール編集フォームのUIを提供し、入力値のバリデーションとプロフィール更新処理のトリガーを行います。
- **resources/js/components/common/UserAvatar.vue**: ユーザーのアバター画像またはイニシャルを表示します。
- **resources/js/components/common/BaseButton.vue**: フォームの「保存」ボタンとして使用されます。
- **resources/js/layouts/DetailLayout.vue**: プロフィール編集ページのレイアウトを提供します。
- **resources/js/components/common/SuccessToast.vue**: プロフィール更新成功時のトースト通知を表示します。

**バリデーション:**

- **resources/js/validators/profileValidator.js**: `ProfileEdit.vue`でクライアントサイドの入力値（名前、メールアドレス）のバリデーションに使用されます。

### 7.1 正常なプロフィール更新

- [x]  プロフィールページから「編集」ボタンをクリックしてプロフィール編集ページ (`/profile/edit`) にアクセスしてください。
- [x]  現在の名前とメールアドレスがフォームに正しく表示されていることを確認してください。
- [x]  名前またはメールアドレスを変更し、「保存」ボタンをクリックしてください。
- [x]  「更新完了」トーストメッセージが表示され、プロフィールページにリダイレクトされ、変更が反映されていることを確認してください。

### 7.2 バリデーションエラー

**名前:**

- [x]  名前を空欄にして保存し、「名前は必須項目です。」と表示されることを確認してください。
- [x]  名前を51文字以上にして保存し、「名前は50文字以内で入力してください」と表示されることを確認してください。

**7.4 メールアドレス:**

- [x]  メールアドレスを空欄にして保存し、「メールアドレスは必須項目です。」と表示されることを確認してください。
- [x]  無効なメールアドレス形式で保存し、「メールアドレスは有効な形式で指定してください。」と表示されることを確認してください。
- [x]  既に登録済みのメールアドレスで保存し、「指定のメールアドレスは既に使用されています。」と表示されることを確認してください。

### 7.3 未保存の変更の確認

- [x]  フォームの内容を変更した後、「キャンセル」ボタンをクリックし、「編集内容が保存されていません」という確認モーダルが表示されることを確認してください。
  - このページは未実装
- [x]  モーダルで「破棄」を選択すると、変更が破棄されプロフィールページに戻ることを確認してください。
  - このページは未実装

### 7.4 ローディング表示

- [x]  プロフィール更新処理中に「保存」ボタンがローディング状態になることを確認してください。

### 7.5 APIエラーハンドリング

- [x]  API通信でエラーが発生した場合、適切なエラーメッセージが表示されることを確認してください。

---

## **8. プロフィール画像アップロード**

### **関連ファイル**

**コントローラー:**

- **app/Http/Controllers/UserController.php**: `avatarUpload` - アバター画像のアップロードを処理します。
- **app/Http/Requests/User/AvatarUploadRequest.php**: アバター画像アップロードのサーバーサイドバリデーションルールを定義します。

**サービス:**

- **app/Services/User/AvatarService.php**: 画像のアップロード、既存画像の削除、MIMEタイプの検証などのビジネスロジックを処理します。

**Piniaストア:**

- **resources/js/stores/auth.js**: `uploadAvatar` - アバター画像アップロードAPIを呼び出し、ストアのユーザー情報を更新します。

**Composables:**

- **resources/js/composables/useUser.js**: `uploadAvatar` - アバター画像アップロード処理を`authStore`に委譲します。

**コンポーネント:**

- **resources/js/views/user/ProfileEdit.vue**: アバター画像変更ボタンを提供し、モーダルを表示します。
- **resources/js/components/common/AvatarUploadModal.vue**: 画像選択、プレビュー、アップロード実行を行うモーダルUI。
- **resources/js/components/common/UserAvatar.vue**: アップロードされたアバターを表示します。

**バリデーション:**

- **resources/js/validators/profileValidator.js**: `validateAvatarFile` - クライアントサイドでのファイルサイズと形式のバリデーション。

### **8.1 正常なアップロード**

- [x]  プロフィール編集ページ (`/profile/edit`) で「画像を変更」ボタンをクリックし、モーダルが表示されることを確認してください。
- [x]  モーダル内のプレビューが現在の設定（またはデフォルト）に従い `w-24 h-24` のサイズで表示されることを確認してください。
- [x]  正しい形式（JPG, PNG, WebP）かつ2MB以下の画像を選択し、プレビューが即座に切り替わることを確認してください。
- [x]  「適用する」ボタンをクリックし、アップロード処理が開始されることを確認してください。
- [x]  アップロード成功後、モーダルが自動的に閉じることを確認してください
- [x]  「更新完了」トーストは表示されないことを確認してください
- [x]  プロフィール編集画面、およびサイドバー（ヘッダー）のアバター画像が新しいものに更新されていることを確認してください。

### **8.2 バリデーションエラー（クライアントサイド）**

- [x]  2MBを超える画像ファイルを選択し、「画像ファイルは2MB以下にしてください」というエラーメッセージが表示されることを確認してください。
- [x]  対応していない形式（例: GIF、PDFなど）のファイルを選択し、「対応形式: JPEG, PNG, WebP」というエラーメッセージが表示されることを確認してください。
- [x]  エラー状態では「適用する」ボタンがクリックできない（または無効な動作になる）ことを確認してください。

### **8.3 バリデーションエラー（サーバーサイド）**

- [x]  サーバー側でバリデーションエラーが発生した場合（例: `AvatarUploadRequest` でエラーなど）、モーダル内に適切なエラーメッセージが表示されることを確認してください。

### **8.4 キャンセル処理**

- [x]  画像を選択した状態で「キャンセル」ボタン、または背景のオーバーレイをクリックし、モーダルが閉じることを確認してください。
- [x]  再度モーダルを開いた際、前回の選択状態がリセットされていることを確認してください。

### **8.5 既存画像の削除**

- [x]  新しいアバターをアップロードした後、サーバーの `storage/app/public/images/avatars/` 内から古い画像ファイルが削除されていることを確認してください。

---
