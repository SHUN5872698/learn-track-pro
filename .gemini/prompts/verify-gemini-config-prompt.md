# GEMINI.md整合性検証

このプロンプトは、[GEMINI.md](../GEMINI.md)に記載されている参照パス・設定が現在のリポジトリ構造と一致しているかを検証する `workflow:verify-gemini-config` の実行をガイドします。

## パラメータ:
- `target_path`: 検証するファイルのパス。
  - 省略時は `.gemini/GEMINI.md`
- `--fix`: 不整合を自動修正
- `--report-only`: 検証結果の報告のみ

## ステップ:

1. **引数の解析**: ユーザーのリクエストから `target_path` とオプションを抽出します。
2. **対象ファイルの読み込み**: 指定された `target_path`（省略時は `.gemini/GEMINI.md`）の内容を読み込みます。
3. **参照パスの抽出**: ファイル内のすべてのパス参照を抽出します。
4. **検証の実行**: 各検証項目を実行し、結果を記録します。
5. **結果の報告**: サマリー形式で検証結果を出力します。
6. **修正の適用**: `--fix` オプション指定時は不整合を自動修正します。

## 検証項目:

### 1. 参照ドキュメントのパス検証
[GEMINI.md](../GEMINI.md)内で参照されているドキュメントパスが実際に存在するか確認します。

**対象パターン**:
- `.gemini/docs/` 配下のファイル参照
- `.gemini/memorys/` 配下のファイル参照
- `.gemini/prompts/` 配下のファイル参照
- `.gemini/outputs/` 配下のファイル参照

**検証方法**:
```

# 各パスに対してファイル存在チェック

test -f <パス> && echo "存在" || echo "不存在"

```

### 2. ワークフロープロンプトの整合性検証
`workflow:` で定義されているワークフローに対応するプロンプトファイルが存在するか確認します。

**検証内容**:
- ワークフロー定義内で参照されているプロンプトファイルが存在するか
- プロンプトファイル内のワークフロー名が一致しているか

### 3. 技術スタック情報の整合性検証
[GEMINI.md](../GEMINI.md)に記載されている技術バージョンが実際の設定ファイルと一致するか確認します。

**検証対象**:
| 記載項目 | 検証元ファイル | 検証キー |
|----------|----------------|----------|
| PHP | `composer.json` | `require.php` |
| Laravel | `composer.json` | `require.laravel/framework` |
| Vue.js | `package.json` | `dependencies.vue` |
| TailwindCSS | `package.json` | `devDependencies.tailwindcss` |
| MySQL | `docker-compose.yml` | `services.mysql.image` |

### 4. ディレクトリ構造記載の検証
[GEMINI.md](../GEMINI.md)に記載されているディレクトリ構造が実際の構造と一致するか確認します。

**検証対象**:
- フロントエンド: `resources/js/` 配下の構造
- バックエンド: `app/` 配下の構造

## 出力形式:

### サマリー
```

## 検証結果サマリー

- 検証日時: YYYY-MM-DD HH:mm
- 対象ファイル: [GEMINI.md](../GEMINI.md)
- 検証項目数: XX
- ✅ 正常: XX件
- ❌ 不整合: XX件
- ⚠️ 要確認: XX件

```

### 詳細レポート
```

## 詳細

### ✅ 正常（存在確認OK）

| カテゴリ | パス | 状態 |
| --- | --- | --- |
| ドキュメント | .gemini/docs/[xxx.md](http://xxx.md) | 存在 |

### ❌ 不整合（要修正）

| カテゴリ | 記載パス | 問題 | 推奨対応 |
| --- | --- | --- | --- |
| プロンプト | .gemini/prompts/[xxx.md](http://xxx.md) | ファイル不存在 | パス修正 or ファイル作成 |

### ⚠️ 要確認（手動確認推奨）

| カテゴリ | 項目 | [GEMINI.md](../GEMINI.md)記載 | 実際の値 |
| --- | --- | --- | --- |
| バージョン | Laravel | 12.x | 11.x |

```

## 修正ルール:

### 自動修正可能な不整合
- **ファイル名の変更**: パス内のファイル名が変更されている場合、新しいパスに更新
- **ディレクトリ移動**: ファイルが別ディレクトリに移動している場合、新しいパスに更新
- **バージョン不一致**: 設定ファイルの値に合わせて更新

### 手動確認が必要な不整合
- **ファイル削除**: 参照先ファイルが完全に削除されている場合
- **構造の大幅変更**: ディレクトリ構造が大きく変更されている場合
- **ワークフローの廃止**: ワークフロー自体が不要になった可能性がある場合

## 修正適用時の出力:

```bash
## 修正内容

### 適用した修正
| 箇所 | 修正前 | 修正後 |
| --- | --- | --- |
| L15 | .gemini/docs/[old-path.md](http://old-path.md) | .gemini/docs/[new-path.md](http://new-path.md) |

### 差分
- 修正前の行
+ 修正後の行
```

## 使用例:

### 基本的な検証（レポートのみ）
```bash
workflow:verify-gemini-config
--report-only
```

### 自動修正付き検証
```bash
workflow:verify-gemini-config
--fix
```

### 特定ファイルの検証
```bash
workflow:verify-gemini-config
[GEMINI.md](../GEMINI.md)
--fix
```
