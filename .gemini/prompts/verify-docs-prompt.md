# ドキュメント整合性検証（カテゴリ別精査）

このプロンプトは、ドキュメントの記載内容が絶対情報源および現在のコードベースと一致しているかをカテゴリごとに精査する `workflow:verify-docs` の実行をガイドします。

## 設計思想

### 絶対情報源（Single Source of Truth）
- [GEMINI.md](../GEMINI.md) を絶対情報源とする
- バージョン情報、技術スタック、ディレクトリ構造等は絶対情報源を基準に検証
- 絶対情報源に記載しきれない詳細情報のみ、参照されているドキュメントまたは実際のコードを確認

### カテゴリ別精査
一括チェックではなくカテゴリごとに深く精査することで、以下を実現します：
- 各カテゴリに特化した検証観点で精度を上げる
- 検証結果が見やすく、修正作業も分割できる
- GeminiCLIの文脈を保持しやすい

### 報告ファイルによるコンテキスト分離
- 検証結果はファイルに出力し、AIの記憶に依存しない
- 途中経過がファイルに残り、再開可能
- 最終報告はファイルを読み込んで集計するため、抜け漏れなし

## パラメータ:
- `category_path`: 検証するカテゴリのパス
  - 例: .gemini/docs/apis/
  - 省略時: 全カテゴリを段階的にチェック
- `--fix`: 不整合を自動修正
- `--report-only`: 検証結果の報告のみ

## 報告ファイル構造:
.gemini/outputs/verify/
├── `apis.md`
├── `architectures.md`
├── `cookbooks.md`
├── `databases.md`
├── `decisions.md`
├── `designs.md`
├── `development-processes.md`
├── `infrastructures.md`
├── `project-infos.md`
├── `securities.md`
├── `tasks.md`
├── `tests.md`
└── `summary.md`（最終サマリー）

### 報告ファイル運用ルール:
- 日付なし（固定ファイル名）
- 毎回追記（上書きではない）
- 完了時にユーザーが手動で内容を削除
- --fix使用時も同じファイルに修正内容を記録

## 対象カテゴリ一覧:
1. .gemini/docs/apis/
2. .gemini/docs/architectures/
3. .gemini/docs/cookbooks/
4. .gemini/docs/databases/
5. .gemini/docs/decisions/
6. .gemini/docs/designs/
7. .gemini/docs/development-processes/
8. .gemini/docs/infrastructures/
9. .gemini/docs/project-infos/
10. .gemini/docs/securities/
11. .gemini/docs/tasks/
12. .gemini/docs/tests/

## ステップ:

### 事前準備（必須）:
1. 絶対情報源の読み込み: .gemini/GEMINI.md を読み込みます。
2. 報告ディレクトリの確認: .gemini/outputs/verify/ ディレクトリが存在しない場合は作成します。

### カテゴリ指定時:
1. 引数の解析: ユーザーのリクエストから category_path とオプションを抽出します。
2. カテゴリの特定: パスからカテゴリを判定し、対応する検証観点を選択します。
3. ドキュメントの読み込み: 指定カテゴリ内のすべてのドキュメントを読み込みます。
4. 内容の精査: カテゴリ特有の検証観点で各ドキュメントの内容を精査します。
5. 絶対情報源との照合: 記載内容を絶対情報源の情報と照合します。
6. コードベースとの照合: 絶対情報源に記載がない詳細情報のみ、実際のコード・設定ファイルと照合します。
7. 報告ファイルへの追記: 検証結果を .gemini/outputs/verify/<カテゴリ名>.md に追記します。
8. 修正の適用: --fix オプション指定時は不整合を自動修正し、修正内容も報告ファイルに追記します。

### カテゴリ省略時（全カテゴリ段階的チェック）:
1. 対象カテゴリ一覧の順序で、1カテゴリずつ検証を実行します。
2. 各カテゴリの検証完了後、報告ファイルに追記してから次のカテゴリへ進みます。
3. 全カテゴリ完了後、summary.md に最終サマリーを出力します。

## 実行制約（必須）:
- 1カテゴリの検証が完了したら、必ず報告ファイルに追記してから次のカテゴリへ進むこと
- 複数カテゴリを同時に検証しないこと
- 報告ファイルへの追記を省略しないこと
- 絶対情報源を正として扱い、矛盾がある場合は絶対情報源を基準とすること

## 検証フロー:

絶対情報源（.gemini/GEMINI.md）
    │
    ├── バージョン情報 ← これが正
    ├── 技術スタック ← これが正
    ├── 参照ドキュメント一覧 ← これが正
    │
    ↓
各ドキュメント
    │
    ├── バージョン記載 → 絶対情報源と照合
    ├── 技術スタック記載 → 絶対情報源と照合
    ├── パス参照 → 絶対情報源の参照先と照合
    ├── 詳細情報 → 絶対情報源で参照されているファイルまたは実際のコードと照合
    │
    ↓
不整合を検出 → 報告ファイルに追記

## カテゴリ別検証観点:

### apis/
- エンドポイントURL（routes/api.php と照合）
- HTTPメソッド（GET/POST/PUT/DELETE）
- リクエストパラメータ（FormRequest と照合）
- レスポンス形式（Resource/Controller と照合）
- ステータスコード
- 認証要件

### architectures/
- ディレクトリ構造（絶対情報源の参照先および実際の構造と照合）
- コンポーネント図の正確性
- レイヤー構成（Controller/Service/Repository）
- ファイル配置ルール

### databases/
- テーブル名（マイグレーションと照合）
- カラム名・型（マイグレーションと照合）
- リレーション定義（Modelと照合）
- インデックス定義

### development-processes/
- コマンド例の正確性（絶対情報源の主要コマンドと照合）
- ファイルパスの存在
- 設定値（config/ と照合）
- 環境変数

### infrastructures/
- Docker設定（docker-compose.yml と照合）
- 環境変数
- ポート番号
- ボリュームマウント

### designs/
- 画面フロー（routes と照合）
- コンポーネント名（実際のファイルと照合）
- UI要素の名称

### decisions/
- 採用した技術の現状との整合性（絶対情報源と照合）
- 方針が現在も有効か
- 参照しているドキュメントの存在

### project-infos/
- バージョン情報（絶対情報源と照合）
- 技術スタック（絶対情報源と照合）
- 機能一覧の最新性
- 実装状況の正確性

### cookbooks/
- 手順の実行可能性
- コード例の正確性
- 参照ファイルの存在

### securities/
- 認証・認可の実装状況
- セキュリティ設定の現状

### tasks/
- タスクの完了状況
- 参照Issueの状態

### tests/
- テストファイルの存在
- テストケースの網羅性

## 共通検証項目:

### 1. 絶対情報源との整合性
- バージョン情報が絶対情報源と一致するか
- 技術スタックの記載が絶対情報源と一致するか
- 参照パスが絶対情報源で定義されているものと一致するか

### 2. パス参照の検証
ドキュメント内で参照されているファイルパスが実際に存在するか確認します。

### 3. コードスニペットの検証
- インポートパスが正しいか
- 関数名・クラス名が実在するか
- 引数・戻り値の型が一致するか

### 4. ディレクトリ構造の検証
記載されているディレクトリツリーが実際の構造と一致するか確認します。

### 5. 用語・名称の検証
- コンポーネント名
- 変数名・関数名
- クラス名

## 報告ファイルフォーマット:

### フォーマット規則:
- 各実行は「---」で区切り、追記時に過去の記録と混同しないようにする
- ステータスは 3段階: ✅ 良好 / ⚠️ 注意 / ❌ 問題あり
- サマリーは統一フォーマットで記載し、一目で状況を把握できるようにする

### カテゴリ別報告ファイル（例: apis.md）

---
# apis/ 検証レポート

## 検証実行: YYYY-MM-DD HH:mm

### サマリー
- ステータス: ✅ 良好 / ⚠️ 注意 / ❌ 問題あり
- 検証ファイル数: XX
- 正常: XX件
- 不整合: XX件
- 要確認: XX件

### 詳細

#### 正常
| ファイル | 検証項目 | 状態 |
|----------|----------|------|

#### 不整合（要修正）
| ファイル | 問題箇所 | 問題内容 | 推奨対応 |
|----------|----------|----------|----------|

#### 要確認（手動確認推奨）
| ファイル | 項目 | 記載値 | 実際の値 |
|----------|------|--------|----------|

#### 修正内容（--fix使用時）
| ファイル | 箇所 | 修正前 | 修正後 |
|----------|------|--------|--------|

---

### 追記時のフォーマット例
既存の内容がある場合、以下のように「---」で区切って追記します:

（既存の内容）

---
## 検証実行: YYYY-MM-DD HH:mm（2回目）

### サマリー
- ステータス: ⚠️ 注意
...

---

### 最終サマリーファイル（summary.md）

---
# ドキュメント検証 最終サマリー

## 検証完了: YYYY-MM-DD HH:mm

### 総合ステータス: ✅ 良好 / ⚠️ 注意 / ❌ 問題あり

### 総合結果
- 検証カテゴリ数: 12
- 総検証ファイル数: XX
- 正常: XX件
- 不整合: XX件
- 要確認: XX件

### カテゴリ別結果一覧
| カテゴリ | ステータス | ファイル数 | 正常 | 不整合 | 要確認 | 主な課題 |
|----------|------------|------------|------|--------|--------|----------|
| apis/ | ✅ | X | X | X | X | - |
| architectures/ | ✅ | X | X | X | X | - |
| cookbooks/ | ❌ | X | X | X | X | ディレクトリ不存在 |
| databases/ | ✅ | X | X | X | X | - |
| decisions/ | ✅ | X | X | X | X | - |
| designs/ | ✅ | X | X | X | X | - |
| development-processes/ | ⚠️ | X | X | X | X | 規約違反あり |
| infrastructures/ | ❌ | X | X | X | X | ドキュメント欠落 |
| project-infos/ | ⚠️ | X | X | X | X | 重複ファイル |
| securities/ | ⚠️ | X | X | X | X | 分類ミス |
| tasks/ | ✅ | X | X | X | X | - |
| tests/ | ✅ | X | X | X | X | - |

### 要対応項目（優先度順）

#### High Priority
- 対象ファイル・内容・推奨アクション

#### Medium Priority
- 対象ファイル・内容・推奨アクション

#### Low Priority
- 対象ファイル・内容・推奨アクション

---

## 修正ルール:

### 自動修正可能
- パスの修正: 新しいパスに更新
- 名称の修正: 実際の名称に更新
- バージョンの修正: 絶対情報源の値に合わせて更新
- ディレクトリ構造の更新: 実際の構造に合わせて更新

### 手動確認が必要
- ファイル削除: 参照先が完全に削除されている場合
- 大幅な変更: 構造や設計が大きく変更されている場合
- 意図的な差異: 将来の実装予定などで意図的に異なる場合
- 絶対情報源との矛盾: 絶対情報源自体の更新が必要な場合

## 使用例:

### 全カテゴリを段階的にチェック（パラメータなし）
workflow:verify-docs

### 全カテゴリをチェックして修正
workflow:verify-docs
--fix

### 特定カテゴリのみ検証
workflow:verify-docs
.gemini/docs/apis/

### 特定カテゴリを検証して修正
workflow:verify-docs
.gemini/docs/architectures/
--fix

## 推奨フロー:

### フロー1: 全カテゴリ段階的チェック
1. workflow:verify-docs で全カテゴリを段階的に検証
2. 各カテゴリの報告ファイルを確認
3. summary.md で全体像を把握
4. 優先度の高いカテゴリから個別に修正

### フロー2: カテゴリごと（精密検証）
1. カテゴリを1つ指定して検証
2. 報告ファイルを確認
3. 必要に応じて --fix で修正
4. 完了したら次のカテゴリへ
5. 全カテゴリ完了までくりかえし

## 進捗チェックリスト:
- [ ] apis/
- [ ] architectures/
- [ ] cookbooks/
- [ ] databases/
- [ ] decisions/
- [ ] designs/
- [ ] development-processes/
- [ ] infrastructures/
- [ ] project-infos/
- [ ] securities/
- [ ] tasks/
- [ ] tests/
- [ ] summary（最終サマリー）
