# Workflow: add-comments

このプロンプトは、コードに意図を説明するコメントを自動的に追加する `workflow:add-comments` の実行をガイドします。

## パラメータ:
- `file_path`: 処理するファイルのパスを指定します。複数ファイルは現在サポートしていません。

## ステップ:

1. **引数の解析**: ユーザーのリクエストから `file_path` を抽出します。
2. **ファイルの読み込み**: 指定された `file_path` の内容を読み込みます。
3. **拡張子の判定**: `file_path` から拡張子を判定し、対応する追加ルールを選択します。
4. **コメントの追加**: コードの構造と処理内容を解析し、以下の基準に基づいてコメントを生成・追加します。
5. **ファイルの出力**: コメント追加後のファイルを上書き保存します。

## コメント基準（全言語共通）:

- コメントは処理の「Why（なぜ）」を説明し、「What（何を）」は避ける。
- **後で見返したときに意図がすぐ分かる**レベルの詳細さを保つ。
- 複雑なロジックや非直感的な実装の理由が明確になるようにする。
- 原則1〜2行の簡潔なコメントとし、複雑なロジックは2〜3行まで許容する。
- コードで表現できない補足のみを追加し、過剰なコメントを避ける。
- 別のエンジニアが処理の意図を誤解しないような箇所に限定する。

### コメント接頭辞（全言語共通）:
特定の状況を明示するために、以下の接頭辞を使用する：

- **TODO**: あとで手をつける必要があるタスク
- **FIXME**: 既知の不具合があるコード（修正が必要）
- **HACK**: あまりキレイじゃない解決策（リファクタリング推奨）
- **XXX**: 危険！ 大きな問題がある（緊急対応が必要）
- **NOTE**: 重要な補足情報・注意事項

使用例：
```
// TODO: エラーハンドリングを追加

// FIXME: 並び順が正しくソートされない場合がある

// HACK: 一時的にorder + 10000で退避（ユニーク制約回避のため）

// XXX: この処理はセキュリティリスクあり

// NOTE: このメソッドはレガシーコードとの互換性のために維持

```

### コメントを残すポイント:
1. **ビジネスルール** - なぜこの条件チェック・制約が必要か
2. **データ整合性・トランザクション** - なぜここで更新・同期するか、何の整合性を保証するか
3. **パフォーマンス最適化** - なぜこの方法・実装を選んだか
4. **認可・権限制御** - 誰の何を防止するか
5. **非直感的な実装** - なぜこの複雑な処理が必要か

### コメント不要な箇所:
- メソッド名や変数名をそのまま繰り返しただけのWhat（何を）の説明
  - ❌ 悪い例: `async fetchContents() { // 学習コンテンツを取得`
  - ✅ 良い例: `async fetchContents() { // 学習コンテンツのリストを取得`（役割を説明）
- コードを読めば明らかな処理の流れ
- フレームワークの標準的な使い方（設定ファイルなどを除く）

## 言語別追加ルール:

### PHP（`.php`）:
- **PHPDocは必ず保持**: すべてのメソッドの`@param`、`@return`、説明文を残す
- クラスレベルのPHPDocも保持する

### Vue（`.vue`）:
- ライフサイクルフックには「なぜこのタイミングか」を追記
- リアクティブ設計（ref/reactiveの使い分け）の理由を追記

### JavaScript/TypeScript（`.js`, `.ts`）:
- **重要な関数にはJSDocを保持**
- **stateプロパティ**: 役割と用途を簡潔に説明
  - 例: `contents: [], // 学習コンテンツのリスト`
- **async処理**: なぜその変数に代入するか、なぜ分割して保存するかを説明
  - 例: `// APIレスポンスにはコンテンツとページネーション情報が混在しているため分割して保存`
- **条件分岐**: なぜそのチェックが必要かを説明
  - 例: `if (index !== -1) { // findIndex()が-1を返す場合のエラー防止`
- **データ整合性**: なぜそのストアを更新するか、何の整合性を保つかを説明
  - 例: `// sectionsStoreとの整合性を保つため、両ストアへ追加`
- **TypeScript使用時は型で説明できる内容はコメント不要**
